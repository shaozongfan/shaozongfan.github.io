"use strict";(self.webpackChunkshaozongfan_website=self.webpackChunkshaozongfan_website||[]).push([[9657],{3905:function(e,t,n){n.d(t,{Zo:function(){return _},kt:function(){return a}});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=r.createContext({}),s=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},_=function(e){var t=s(e.components);return r.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,u=e.parentName,_=c(e,["components","mdxType","originalType","parentName"]),d=s(n),a=i,f=d["".concat(u,".").concat(a)]||d[a]||p[a]||o;return n?r.createElement(f,l(l({ref:t},_),{},{components:n})):r.createElement(f,l({ref:t},_))}));function a(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,l=new Array(o);l[0]=d;var c={};for(var u in t)hasOwnProperty.call(t,u)&&(c[u]=t[u]);c.originalType=e,c.mdxType="string"==typeof e?e:i,l[1]=c;for(var s=2;s<o;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},55804:function(e,t,n){n.r(t),n.d(t,{assets:function(){return _},contentTitle:function(){return u},default:function(){return a},frontMatter:function(){return c},metadata:function(){return s},toc:function(){return p}});var r=n(87462),i=n(63366),o=(n(67294),n(3905)),l=["components"],c={},u="6.1.1\u3000cdev\u7ed3\u6784\u4f53",s={permalink:"/blog/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/6.1\u3000Linux\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7ed3\u6784",editUrl:"https://github.com/shaozongfan/shaozongfan.github.io/blog/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/6.1\u3000Linux\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7ed3\u6784.md",source:"@site/blog/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/6.1\u3000Linux\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7ed3\u6784.md",title:"6.1.1\u3000cdev\u7ed3\u6784\u4f53",description:"\u5728Linux\u5185\u6838\u4e2d\uff0c\u4f7f\u7528cdev\u7ed3\u6784\u4f53\u63cf\u8ff0\u4e00\u4e2a\u5b57\u7b26\u8bbe\u5907\uff0ccdev\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u5982\u4ee3\u7801\u6e05\u53556.1\u3002",date:"2025-09-15T14:44:15.057Z",formattedDate:"2025\u5e749\u670815\u65e5",tags:[],readingTime:16.875,truncated:!1,authors:[],frontMatter:{},prevItem:{title:"\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/11.5\u3000IO\u5185\u5b58\u9759\u6001\u6620\u5c04",permalink:"/blog/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/11.5\u3000IO\u5185\u5b58\u9759\u6001\u6620\u5c04"},nextItem:{title:"12.3.1\u3000\u8bbe\u5907\u9a71\u52a8\u6838\u5fc3\u5c42\u548c\u4f8b\u5316",permalink:"/blog/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/12.3\u3000\u8bbe\u5907\u9a71\u52a8\u7684\u5206\u5c42\u601d\u60f3"}},_={authorsImageUrls:[]},p=[{value:"1.\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u4e0e\u5378\u8f7d\u51fd\u6570",id:"1\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u4e0e\u5378\u8f7d\u51fd\u6570",level:2},{value:"2.\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u51fd\u6570",id:"2\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u51fd\u6570",level:2}],d={toc:p};function a(e){var t=e.components,c=(0,i.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},d,c,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5728Linux\u5185\u6838\u4e2d\uff0c\u4f7f\u7528cdev\u7ed3\u6784\u4f53\u63cf\u8ff0\u4e00\u4e2a\u5b57\u7b26\u8bbe\u5907\uff0ccdev\u7ed3\u6784\u4f53\u7684\u5b9a\u4e49\u5982\u4ee3\u7801\u6e05\u53556.1\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.1\u3000cdev\u7ed3\u6784\u4f53"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"1struct cdev {\n2  struct kobject kobj;             /* \u5185\u5d4c\u7684kobject\u5bf9\u8c61*/\n3  struct module *owner;            /* \u6240\u5c5e\u6a21\u5757*/\n4  struct file_operations *ops;     /* \u6587\u4ef6\u64cd\u4f5c\u7ed3\u6784\u4f53*/\n5  struct list_head list;\n6  dev_t dev;                       /* \u8bbe\u5907\u53f7*/\n7  unsigned int count;\n8};\n")),(0,o.kt)("p",null,"cdev\u7ed3\u6784\u4f53\u7684dev_t\u6210\u5458\u5b9a\u4e49\u4e86\u8bbe\u5907\u53f7\uff0c\u4e3a32\u4f4d\uff0c\u5176\u4e2d12\u4f4d\u4e3a\u4e3b\u8bbe\u5907\u53f7\uff0c20\u4f4d\u4e3a\u6b21\u8bbe\u5907\u53f7\u3002\u4f7f\u7528\u4e0b\u5217\u5b8f\u53ef\u4ee5\u4ecedev_t\u83b7\u5f97\u4e3b\u8bbe\u5907\u53f7\u548c\u6b21\u8bbe\u5907\u53f7\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"MAJOR(dev_t dev)\nMINOR(dev_t dev)\n")),(0,o.kt)("p",null,"\u800c\u4f7f\u7528\u4e0b\u5217\u5b8f\u5219\u53ef\u4ee5\u901a\u8fc7\u4e3b\u8bbe\u5907\u53f7\u548c\u6b21\u8bbe\u5907\u53f7\u751f\u6210dev_t\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"MKDEV(int major, int minor)\n")),(0,o.kt)("p",null,"cdev\u7ed3\u6784\u4f53\u7684\u53e6\u4e00\u4e2a\u91cd\u8981\u6210\u5458file_operations\u5b9a\u4e49\u4e86\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u63d0\u4f9b\u7ed9\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u7684\u63a5\u53e3\u51fd\u6570\u3002"),(0,o.kt)("p",null,"Linux\u5185\u6838\u63d0\u4f9b\u4e86\u4e00\u7ec4\u51fd\u6570\u4ee5\u7528\u4e8e\u64cd\u4f5ccdev\u7ed3\u6784\u4f53\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"void cdev_init(struct cdev *, struct file_operations *);\nstruct cdev *cdev_alloc(void);\nvoid cdev_put(struct cdev *p);\nint cdev_add(struct cdev *, dev_t, unsigned);\nvoid cdev_del(struct cdev *);\n")),(0,o.kt)("p",null,"cdev_init\uff08\uff09\u51fd\u6570\u7528\u4e8e\u521d\u59cb\u5316cdev\u7684\u6210\u5458\uff0c\u5e76\u5efa\u7acbcdev\u548cfile_operations\u4e4b\u95f4\u7684\u8fde\u63a5\uff0c\u5176\u6e90\u4ee3\u7801\u5982\u4ee3\u7801\u6e05\u53556.2\u6240\u793a\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.2\u3000cdev_init\uff08\uff09\u51fd\u6570"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"1void cdev_init(struct cdev *cdev, struct file_operations *fops)\n2{\n3    memset(cdev, 0, sizeof *cdev);\n4    INIT_LIST_HEAD(&cdev->list);\n5    kobject_init(&cdev->kobj, &ktype_cdev_default);\n6    cdev->ops = fops; /* \u5c06\u4f20\u5165\u7684\u6587\u4ef6\u64cd\u4f5c\u7ed3\u6784\u4f53\u6307\u9488\u8d4b\u503c\u7ed9cdev\u7684ops*/\n7}\n")),(0,o.kt)("p",null,"cdev_alloc\uff08\uff09\u51fd\u6570\u7528\u4e8e\u52a8\u6001\u7533\u8bf7\u4e00\u4e2acdev\u5185\u5b58\uff0c\u5176\u6e90\u4ee3\u7801\u5982\u4ee3\u7801\u6e05\u53556.3\u6240\u793a\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.3\u3000cdev_alloc\uff08\uff09\u51fd\u6570"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"1struct cdev *cdev_alloc(void)\n2{\n3        struct cdev *p = kzalloc(sizeof(struct cdev), GFP_KERNEL);\n4        if (p) {\n5            INIT_LIST_HEAD(&p->list);\n6            kobject_init(&p->kobj, &ktype_cdev_dynamic);\n7        }\n8        return p;\n9}\n")),(0,o.kt)("p",null,"cdev_add\uff08\uff09\u51fd\u6570\u548ccdev_del\uff08\uff09\u51fd\u6570\u5206\u522b\u5411\u7cfb\u7edf\u6dfb\u52a0\u548c\u5220\u9664\u4e00\u4e2acdev\uff0c\u5b8c\u6210\u5b57\u7b26\u8bbe\u5907\u7684\u6ce8\u518c\u548c\u6ce8\u9500\u3002\u5bf9cdev_add\uff08\uff09\u7684\u8c03\u7528\u901a\u5e38\u53d1\u751f\u5728\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u51fd\u6570\u4e2d\uff0c\u800c\u5bf9cdev_del\uff08\uff09\u51fd\u6570\u7684\u8c03\u7528\u5219\u901a\u5e38\u53d1\u751f\u5728\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u5378\u8f7d\u51fd\u6570\u4e2d\u3002"),(0,o.kt)("h1",{id:"612\u5206\u914d\u548c\u91ca\u653e\u8bbe\u5907\u53f7"},"6.1.2\u3000\u5206\u914d\u548c\u91ca\u653e\u8bbe\u5907\u53f7"),(0,o.kt)("p",null,"\u5728\u8c03\u7528cdev_add\uff08\uff09\u51fd\u6570\u5411\u7cfb\u7edf\u6ce8\u518c\u5b57\u7b26\u8bbe\u5907\u4e4b\u524d\uff0c\u5e94\u9996\u5148\u8c03\u7528register_chrdev_region\uff08\uff09\u6216alloc_chrdev_region\uff08\uff09\u51fd\u6570\u5411\u7cfb\u7edf\u7533\u8bf7\u8bbe\u5907\u53f7\uff0c\u8fd9\u4e24\u4e2a\u51fd\u6570\u7684\u539f\u578b\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"int register_chrdev_region(dev_t from, unsigned count, const char *name);\nint alloc_chrdev_region(dev_t *dev, unsigned baseminor, unsigned count,\n              const char *name);\n")),(0,o.kt)("p",null,"register_chrdev_region\uff08\uff09\u51fd\u6570\u7528\u4e8e\u5df2\u77e5\u8d77\u59cb\u8bbe\u5907\u7684\u8bbe\u5907\u53f7\u7684\u60c5\u51b5\uff0c\u800calloc_chrdev_region\uff08\uff09\u7528\u4e8e\u8bbe\u5907\u53f7\u672a\u77e5\uff0c\u5411\u7cfb\u7edf\u52a8\u6001\u7533\u8bf7\u672a\u88ab\u5360\u7528\u7684\u8bbe\u5907\u53f7\u7684\u60c5\u51b5\uff0c\u51fd\u6570\u8c03\u7528\u6210\u529f\u4e4b\u540e\uff0c\u4f1a\u628a\u5f97\u5230\u7684\u8bbe\u5907\u53f7\u653e\u5165\u7b2c\u4e00\u4e2a\u53c2\u6570dev\u4e2d\u3002alloc_chrdev_region\uff08\uff09\u76f8\u6bd4\u4e8eregister_chrdev_region\uff08\uff09\u7684\u4f18\u70b9\u5728\u4e8e\u5b83\u4f1a\u81ea\u52a8\u907f\u5f00\u8bbe\u5907\u53f7\u91cd\u590d\u7684\u51b2\u7a81\u3002"),(0,o.kt)("p",null,"\u76f8\u5e94\u5730\uff0c\u5728\u8c03\u7528cdev_del\uff08\uff09\u51fd\u6570\u4ece\u7cfb\u7edf\u6ce8\u9500\u5b57\u7b26\u8bbe\u5907\u4e4b\u540e\uff0cunregister_chrdev_region\uff08\uff09\u5e94\u8be5\u88ab\u8c03\u7528\u4ee5\u91ca\u653e\u539f\u5148\u7533\u8bf7\u7684\u8bbe\u5907\u53f7\uff0c\u8fd9\u4e2a\u51fd\u6570\u7684\u539f\u578b\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"void unregister_chrdev_region(dev_t from, unsigned count);\n")),(0,o.kt)("h1",{id:"613file_operations\u7ed3\u6784\u4f53"},"6.1.3\u3000file_operations\u7ed3\u6784\u4f53"),(0,o.kt)("p",null,"file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u51fd\u6570\u662f\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u8bbe\u8ba1\u7684\u4e3b\u4f53\u5185\u5bb9\uff0c\u8fd9\u4e9b\u51fd\u6570\u5b9e\u9645\u4f1a\u5728\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884cLinux\u7684open\uff08\uff09\u3001write\uff08\uff09\u3001read\uff08\uff09\u3001close\uff08\uff09\u7b49\u7cfb\u7edf\u8c03\u7528\u65f6\u6700\u7ec8\u88ab\u5185\u6838\u8c03\u7528\u3002file_operations\u7ed3\u6784\u4f53\u76ee\u524d\u5df2\u7ecf\u6bd4\u8f83\u5e9e\u5927\uff0c\u5b83\u7684\u5b9a\u4e49\u5982\u4ee3\u7801\u6e05\u53556.4\u6240\u793a\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.4\u3000file_operations\u7ed3\u6784\u4f53"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"struct file_operations {\n    struct module *owner;\n    loff_t (*llseek) (struct file *, loff_t, int);\n    ssize_t (*read) (struct file *, char __user *, size_t, loff_t *);\n    ssize_t (*write) (struct file *, const char __user *, size_t, loff_t *);\n    ssize_t (*read_iter) (struct kiocb *, struct iov_iter *);\n    ssize_t (*write_iter) (struct kiocb *, struct iov_iter *);\n    int (*iterate) (struct file *, struct dir_context *);\n    int (*iterate_shared) (struct file *, struct dir_context *);\n    __poll_t (*poll) (struct file *, struct poll_table_struct *);\n    long (*unlocked_ioctl) (struct file *, unsigned int, unsigned long);\n    long (*compat_ioctl) (struct file *, unsigned int, unsigned long);\n    int (*mmap) (struct file *, struct vm_area_struct *);\n    unsigned long mmap_supported_flags;\n    int (*open) (struct inode *, struct file *);\n    int (*flush) (struct file *, fl_owner_t id);\n    int (*release) (struct inode *, struct file *);\n    int (*fsync) (struct file *, loff_t, loff_t, int datasync);\n    int (*fasync) (int, struct file *, int);\n    int (*lock) (struct file *, int, struct file_lock *);\n    ssize_t (*sendpage) (struct file *, struct page *, int, size_t, loff_t *, int);\n    unsigned long (*get_unmapped_area)(struct file *, unsigned long, unsigned long, unsigned long, unsigned long);\n    int (*check_flags)(int);\n    int (*flock) (struct file *, int, struct file_lock *);\n    ssize_t (*splice_write)(struct pipe_inode_info *, struct file *, loff_t *, size_t, unsigned int);\n    ssize_t (*splice_read)(struct file *, loff_t *, struct pipe_inode_info *, size_t, unsigned int);\n    int (*setlease)(struct file *, long, struct file_lock **, void **);\n    long (*fallocate)(struct file *file, int mode, loff_t offset,\n              loff_t len);\n    void (*show_fdinfo)(struct seq_file *m, struct file *f);\n#ifndef CONFIG_MMU\n    unsigned (*mmap_capabilities)(struct file *);\n#endif\n    ssize_t (*copy_file_range)(struct file *, loff_t, struct file *,\n            loff_t, size_t, unsigned int);\n    loff_t (*remap_file_range)(struct file *file_in, loff_t pos_in,\n                   struct file *file_out, loff_t pos_out,\n                   loff_t len, unsigned int remap_flags);\n    int (*fadvise)(struct file *, loff_t, loff_t, int);\n} __randomize_layout;\n")),(0,o.kt)("p",null,"\u4e0b\u9762\u6211\u4eec\u5bf9file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u4e3b\u8981\u6210\u5458\u8fdb\u884c\u5206\u6790\u3002"),(0,o.kt)("p",null,"llseek\uff08\uff09\u51fd\u6570\u7528\u6765\u4fee\u6539\u4e00\u4e2a\u6587\u4ef6\u7684\u5f53\u524d\u8bfb\u5199\u4f4d\u7f6e\uff0c\u5e76\u5c06\u65b0\u4f4d\u7f6e\u8fd4\u56de\uff0c\u5728\u51fa\u9519\u65f6\uff0c\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u8d1f\u503c\u3002"),(0,o.kt)("p",null,"read\uff08\uff09\u51fd\u6570\u7528\u6765\u4ece\u8bbe\u5907\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u6210\u529f\u65f6\u51fd\u6570\u8fd4\u56de\u8bfb\u53d6\u7684\u5b57\u8282\u6570\uff0c\u51fa\u9519\u65f6\u8fd4\u56de\u4e00\u4e2a\u8d1f\u503c\u3002\u5b83\u4e0e\u7528\u6237\u7a7a\u95f4\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684ssize_t read\uff08int fd\uff0cvoid",(0,o.kt)("em",{parentName:"p"},"buf\uff0csize_t count\uff09\u548csize_t fread\uff08void"),"ptr\uff0csize_t size\uff0csize_t nmemb\uff0cFILE*stream\uff09\u5bf9\u5e94\u3002"),(0,o.kt)("p",null,"write\uff08\uff09\u51fd\u6570\u5411\u8bbe\u5907\u53d1\u9001\u6570\u636e\uff0c\u6210\u529f\u65f6\u8be5\u51fd\u6570\u8fd4\u56de\u5199\u5165\u7684\u5b57\u8282\u6570\u3002\u5982\u679c\u6b64\u51fd\u6570\u672a\u88ab\u5b9e\u73b0\uff0c\u5f53\u7528\u6237\u8fdb\u884cwrite\uff08\uff09\u7cfb\u7edf\u8c03\u7528\u65f6\uff0c\u5c06\u5f97\u5230-EINVAL\u8fd4\u56de\u503c\u3002\u5b83\u4e0e\u7528\u6237\u7a7a\u95f4\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684ssize_t write\uff08int fd\uff0cconst void",(0,o.kt)("em",{parentName:"p"},"buf\uff0csize_t count\uff09\u548csize_t fwrite\uff08const void"),"ptr\uff0csize_t size\uff0csize_t nmemb\uff0cFILE*stream\uff09\u5bf9\u5e94\u3002"),(0,o.kt)("p",null,"read\uff08\uff09\u548cwrite\uff08\uff09\u5982\u679c\u8fd4\u56de0\uff0c\u5219\u6697\u793aend-of-file\uff08EOF\uff09\u3002"),(0,o.kt)("p",null,"unlocked_ioctl\uff08\uff09\u63d0\u4f9b\u8bbe\u5907\u76f8\u5173\u63a7\u5236\u547d\u4ee4\u7684\u5b9e\u73b0\uff08\u65e2\u4e0d\u662f\u8bfb\u64cd\u4f5c\uff0c\u4e5f\u4e0d\u662f\u5199\u64cd\u4f5c\uff09\uff0c\u5f53\u8c03\u7528\u6210\u529f\u65f6\uff0c\u8fd4\u56de\u7ed9\u8c03\u7528\u7a0b\u5e8f\u4e00\u4e2a\u975e\u8d1f\u503c\u3002\u5b83\u4e0e\u7528\u6237\u7a7a\u95f4\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528\u7684int fcntl\uff08int fd\uff0cint cmd\uff0c.../",(0,o.kt)("em",{parentName:"p"},"arg"),"/\uff09\u548cint ioctl\uff08int d\uff0cint request\uff0c...\uff09\u5bf9\u5e94\u3002"),(0,o.kt)("p",null,"mmap\uff08\uff09\u51fd\u6570\u5c06\u8bbe\u5907\u5185\u5b58\u6620\u5c04\u5230\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u5982\u679c\u8bbe\u5907\u9a71\u52a8\u672a\u5b9e\u73b0\u6b64\u51fd\u6570\uff0c\u7528\u6237\u8fdb\u884cmmap\uff08\uff09\u7cfb\u7edf\u8c03\u7528\u65f6\u5c06\u83b7\u5f97-ENODEV\u8fd4\u56de\u503c\u3002\u8fd9\u4e2a\u51fd\u6570\u5bf9\u4e8e\u5e27\u7f13\u51b2\u7b49\u8bbe\u5907\u7279\u522b\u6709\u610f\u4e49\uff0c\u5e27\u7f13\u51b2\u88ab\u6620\u5c04\u5230\u7528\u6237\u7a7a\u95f4\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5b83\u800c\u65e0\u987b\u5728\u5185\u6838\u548c\u5e94\u7528\u95f4\u8fdb\u884c\u5185\u5b58\u590d\u5236\u3002\u5b83\u4e0e\u7528\u6237\u7a7a\u95f4\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684void",(0,o.kt)("em",{parentName:"p"},"mmap\uff08void"),"addr\uff0csize_t length\uff0cint prot\uff0cint flags\uff0cint fd\uff0coff_t offset\uff09\u51fd\u6570\u5bf9\u5e94\u3002"),(0,o.kt)("p",null,"\u5f53\u7528\u6237\u7a7a\u95f4\u8c03\u7528Linux API\u51fd\u6570open\uff08\uff09\u6253\u5f00\u8bbe\u5907\u6587\u4ef6\u65f6\uff0c\u8bbe\u5907\u9a71\u52a8\u7684open\uff08\uff09\u51fd\u6570\u6700\u7ec8\u88ab\u8c03\u7528\u3002\u9a71\u52a8\u7a0b\u5e8f\u53ef\u4ee5\u4e0d\u5b9e\u73b0\u8fd9\u4e2a\u51fd\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8bbe\u5907\u7684\u6253\u5f00\u64cd\u4f5c\u6c38\u8fdc\u6210\u529f\u3002\u4e0eopen\uff08\uff09\u51fd\u6570\u5bf9\u5e94\u7684\u662frelease\uff08\uff09\u51fd\u6570\u3002"),(0,o.kt)("p",null,"poll\uff08\uff09\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u8be2\u95ee\u8bbe\u5907\u662f\u5426\u53ef\u88ab\u975e\u963b\u585e\u5730\u7acb\u5373\u8bfb\u5199\u3002\u5f53\u8be2\u95ee\u7684\u6761\u4ef6\u672a\u89e6\u53d1\u65f6\uff0c\u7528\u6237\u7a7a\u95f4\u8fdb\u884cselect\uff08\uff09\u548cpoll\uff08\uff09\u7cfb\u7edf\u8c03\u7528\u5c06\u5f15\u8d77\u8fdb\u7a0b\u7684\u963b\u585e\u3002"),(0,o.kt)("p",null,"aio_read\uff08\uff09\u548caio_write\uff08\uff09\u51fd\u6570\u5206\u522b\u5bf9\u4e0e\u6587\u4ef6\u63cf\u8ff0\u7b26\u5bf9\u5e94\u7684\u8bbe\u5907\u8fdb\u884c\u5f02\u6b65\u8bfb\u3001\u5199\u64cd\u4f5c\u3002\u8bbe\u5907\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u51fd\u6570\u540e\uff0c\u7528\u6237\u7a7a\u95f4\u53ef\u4ee5\u5bf9\u8be5\u8bbe\u5907\u6587\u4ef6\u63cf\u8ff0\u7b26\u6267\u884cSYS_io_setup\u3001SYS_io_submit\u3001SYS_io_getevents\u3001SYS_io_destroy\u7b49\u7cfb\u7edf\u8c03\u7528\u8fdb\u884c\u8bfb\u5199\u3002"),(0,o.kt)("h1",{id:"614linux\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684\u7ec4\u6210"},"6.1.4\u3000Linux\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684\u7ec4\u6210"),(0,o.kt)("p",null,"\u5728Linux\u4e2d\uff0c\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7531\u5982\u4e0b\u51e0\u4e2a\u90e8\u5206\u7ec4\u6210\u3002"),(0,o.kt)("h2",{id:"1\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u4e0e\u5378\u8f7d\u51fd\u6570"},"1.\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u4e0e\u5378\u8f7d\u51fd\u6570"),(0,o.kt)("p",null,"\u5728\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u51fd\u6570\u4e2d\u5e94\u8be5\u5b9e\u73b0\u8bbe\u5907\u53f7\u7684\u7533\u8bf7\u548ccdev\u7684\u6ce8\u518c\uff0c\u800c\u5728\u5378\u8f7d\u51fd\u6570\u4e2d\u5e94\u5b9e\u73b0\u8bbe\u5907\u53f7\u7684\u91ca\u653e\u548ccdev\u7684\u6ce8\u9500\u3002"),(0,o.kt)("p",null,"Linux\u5185\u6838\u7684\u7f16\u7801\u4e60\u60ef\u662f\u4e3a\u8bbe\u5907\u5b9a\u4e49\u4e00\u4e2a\u8bbe\u5907\u76f8\u5173\u7684\u7ed3\u6784\u4f53\uff0c\u8be5\u7ed3\u6784\u4f53\u5305\u542b\u8bbe\u5907\u6240\u6d89\u53ca\u7684cdev\u3001\u79c1\u6709\u6570\u636e\u53ca\u9501\u7b49\u4fe1\u606f\u3002\u5e38\u89c1\u7684\u8bbe\u5907\u7ed3\u6784\u4f53\u3001\u6a21\u5757\u52a0\u8f7d\u548c\u5378\u8f7d\u51fd\u6570\u5f62\u5f0f\u5982\u4ee3\u7801\u6e05\u53556.5\u6240\u793a\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.5\u3000\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u4e0e\u5378\u8f7d\u51fd\u6570\u6a21\u677f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"}," 1/* \u8bbe\u5907\u7ed3\u6784\u4f53\n 2struct xxx_dev_t {\n 3    struct cdev cdev;\n 4  ...\n 5} xxx_dev;\n 6/* \u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u52a0\u8f7d\u51fd\u6570\n 7static int _ _init xxx_init(void)\n 8{\n 9  ...\n10  cdev_init(&xxx_dev.cdev, &xxx_fops);         /* \u521d\u59cb\u5316cdev */\n11  xxx_dev.cdev.owner = THIS_MODULE;\n12  /* \u83b7\u53d6\u5b57\u7b26\u8bbe\u5907\u53f7*/\n13  if (xxx_major) {\n14      register_chrdev_region(xxx_dev_no, 1, DEV_NAME);\n15  } else {\n16      alloc_chrdev_region(&xxx_dev_no, 0, 1, DEV_NAME);\n17  }\n18\n19  ret = cdev_add(&xxx_dev.cdev, xxx_dev_no, 1);  /* \u6ce8\u518c\u8bbe\u5907*/\n20  ...\n21}\n22/* \u8bbe\u5907\u9a71\u52a8\u6a21\u5757\u5378\u8f7d\u51fd\u6570*/\n23static void _ _exit xxx_exit(void)\n24{\n25   unregister_chrdev_region(xxx_dev_no, 1);      /* \u91ca\u653e\u5360\u7528\u7684\u8bbe\u5907\u53f7*/\n26   cdev_del(&xxx_dev.cdev);                      /* \u6ce8\u9500\u8bbe\u5907*/\n27  ...\n28}\n")),(0,o.kt)("h2",{id:"2\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u51fd\u6570"},"2.\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u51fd\u6570"),(0,o.kt)("p",null,"file_operations\u7ed3\u6784\u4f53\u4e2d\u7684\u6210\u5458\u51fd\u6570\u662f\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u4e0e\u5185\u6838\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u7684\u63a5\u53e3\uff0c\u662f\u7528\u6237\u7a7a\u95f4\u5bf9Linux\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u6700\u7ec8\u7684\u843d\u5b9e\u8005\u3002\u5927\u591a\u6570\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u4f1a\u5b9e\u73b0read\uff08\uff09\u3001write\uff08\uff09\u548cioctl\uff08\uff09\u51fd\u6570\uff0c\u5e38\u89c1\u7684\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684\u8fd93\u4e2a\u51fd\u6570\u7684\u5f62\u5f0f\u5982\u4ee3\u7801\u6e05\u53556.6\u6240\u793a\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.6\u3000\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u8bfb\u3001\u5199\u3001I/O\u63a7\u5236\u51fd\u6570\u6a21\u677f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"}," 1 /* \u8bfb\u8bbe\u5907*/\n 2 ssize_t xxx_read(struct file *filp, char __user *buf, size_t count,\n 3    loff_t*f_pos)\n 4 {\n 5    ...\n 6    copy_to_user(buf, ..., ...);\n 7    ...\n 8 }\n 9 /* \u5199\u8bbe\u5907*/\n10 ssize_t xxx_write(struct file *filp, const char __user *buf, size_t count,\n11    loff_t *f_pos)\n12 {\n13    ...\n14    copy_from_user(..., buf, ...);\n15    ...\n16 }\n17 /* ioctl\u51fd\u6570*/\n18 long xxx_ioctl(struct file *filp, unsigned int cmd,\n19    unsigned long arg)\n20 {\n21    ...\n22    switch (cmd) {\n23    case XXX_CMD1:\n24         ...\n25         break;\n26    case XXX_CMD2:\n27         ...\n28         break;\n29    default:\n30         /* \u4e0d\u80fd\u652f\u6301\u7684\u547d\u4ee4*/\n31         return  - ENOTTY;\n32    }\n33    return 0;\n34 }\n")),(0,o.kt)("p",null,"\u8bbe\u5907\u9a71\u52a8\u7684\u8bfb\u51fd\u6570\u4e2d\uff0cfilp\u662f\u6587\u4ef6\u7ed3\u6784\u4f53\u6307\u9488\uff0cbuf\u662f\u7528\u6237\u7a7a\u95f4\u5185\u5b58\u7684\u5730\u5740\uff0c\u8be5\u5730\u5740\u5728\u5185\u6838\u7a7a\u95f4\u4e0d\u5b9c\u76f4\u63a5\u8bfb\u5199\uff0ccount\u662f\u8981\u8bfb\u7684\u5b57\u8282\u6570\uff0cf_pos\u662f\u8bfb\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e\u6587\u4ef6\u5f00\u5934\u7684\u504f\u79fb\u3002"),(0,o.kt)("p",null,"\u8bbe\u5907\u9a71\u52a8\u7684\u5199\u51fd\u6570\u4e2d\uff0cfilp\u662f\u6587\u4ef6\u7ed3\u6784\u4f53\u6307\u9488\uff0cbuf\u662f\u7528\u6237\u7a7a\u95f4\u5185\u5b58\u7684\u5730\u5740\uff0c\u8be5\u5730\u5740\u5728\u5185\u6838\u7a7a\u95f4\u4e0d\u5b9c\u76f4\u63a5\u8bfb\u5199\uff0ccount\u662f\u8981\u5199\u7684\u5b57\u8282\u6570\uff0cf_pos\u662f\u5199\u7684\u4f4d\u7f6e\u76f8\u5bf9\u4e8e\u6587\u4ef6\u5f00\u5934\u7684\u504f\u79fb\u3002"),(0,o.kt)("p",null,"\u7531\u4e8e\u7528\u6237\u7a7a\u95f4\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u5185\u6838\u7a7a\u95f4\u7684\u5185\u5b58\uff0c\u56e0\u6b64\u501f\u52a9\u4e86\u51fd\u6570copy_from_user\uff08\uff09\u5b8c\u6210\u7528\u6237\u7a7a\u95f4\u7f13\u51b2\u533a\u5230\u5185\u6838\u7a7a\u95f4\u7684\u590d\u5236\uff0c\u4ee5\u53cacopy_to_user\uff08\uff09\u5b8c\u6210\u5185\u6838\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7f13\u51b2\u533a\u7684\u590d\u5236\uff0c\u89c1\u4ee3\u7801\u7b2c6\u884c\u548c\u7b2c14\u884c\u3002"),(0,o.kt)("p",null,"\u5b8c\u6210\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u5185\u5b58\u590d\u5236\u7684copy_from_user\uff08\uff09\u548ccopy_to_user\uff08\uff09\u7684\u539f\u578b\u5206\u522b\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"unsigned long copy_from_user(void *to, const void _ _user *from, unsigned long count);\nunsigned long copy_to_user(void _ _user *to, const void *from, unsigned long count);\n")),(0,o.kt)("p",null,"\u4e0a\u8ff0\u51fd\u6570\u5747\u8fd4\u56de\u4e0d\u80fd\u88ab\u590d\u5236\u7684\u5b57\u8282\u6570\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u5b8c\u5168\u590d\u5236\u6210\u529f\uff0c\u8fd4\u56de\u503c\u4e3a0\u3002\u5982\u679c\u590d\u5236\u5931\u8d25\uff0c\u5219\u8fd4\u56de\u8d1f\u503c\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u8981\u590d\u5236\u7684\u5185\u5b58\u662f\u7b80\u5355\u7c7b\u578b\uff0c\u5982char\u3001int\u3001long\u7b49\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u7b80\u5355\u7684put_user\uff08\uff09\u548cget_user\uff08\uff09\uff0c\u5982\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"int val;                         /* \u5185\u6838\u7a7a\u95f4\u6574\u578b\u53d8\u91cf\n...\nget_user(val, (int *) arg);      /* \u7528\u6237\u2192\u5185\u6838\uff0carg\u662f\u7528\u6237\u7a7a\u95f4\u7684\u5730\u5740 */\n...\nput_user(val, (int *) arg);      /* \u5185\u6838\u2192\u7528\u6237\uff0carg\u662f\u7528\u6237\u7a7a\u95f4\u7684\u5730\u5740 */\n")),(0,o.kt)("p",null,"\u8bfb\u548c\u5199\u51fd\u6570\u4e2d\u7684_user\u662f\u4e00\u4e2a\u5b8f\uff0c\u8868\u660e\u5176\u540e\u7684\u6307\u9488\u6307\u5411\u7528\u6237\u7a7a\u95f4\uff0c\u5b9e\u9645\u4e0a\u66f4\u591a\u5730\u5145\u5f53\u4e86\u4ee3\u7801\u81ea\u6ce8\u91ca\u7684\u529f\u80fd\u3002\u8fd9\u4e2a\u5b8f\u5b9a\u4e49\u4e3a\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#ifdef _ _CHECKER_ _\n# define _ _user      _ _attribute_ _((noderef, address_space(1)))\n#else\n# define _ _user\n#endif\n")),(0,o.kt)("p",null,"\u5185\u6838\u7a7a\u95f4\u867d\u7136\u53ef\u4ee5\u8bbf\u95ee\u7528\u6237\u7a7a\u95f4\u7684\u7f13\u51b2\u533a\uff0c\u4f46\u662f\u5728\u8bbf\u95ee\u4e4b\u524d\uff0c\u4e00\u822c\u9700\u8981\u5148\u68c0\u67e5\u5176\u5408\u6cd5\u6027\uff0c\u901a\u8fc7access_ok\uff08type\uff0caddr\uff0csize\uff09\u8fdb\u884c\u5224\u65ad\uff0c\u4ee5\u786e\u5b9a\u4f20\u5165\u7684\u7f13\u51b2\u533a\u7684\u786e\u5c5e\u4e8e\u7528\u6237\u7a7a\u95f4\uff0c\u4f8b\u5982"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"static ssize_t read_port(struct file *file, char __user *buf,\n                         size_t count, loff_t *ppos)\n{\n        unsigned long i = *ppos;\n        char __user *tmp = buf;\n        if (!access_ok(VERIFY_WRITE, buf, count))\n                return -EFAULT;\n        while (count-- > 0 && i < 65536) {\n                if (__put_user(inb(i), tmp) < 0)\n                        return -EFAULT;\n                i++;\n                tmp++;\n        }\n        *ppos = i;\n        return tmp-buf;\n}\n")),(0,o.kt)("p",null,"\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u5f15\u7528\u7684",(0,o.kt)("strong",{parentName:"p"},"put_user\uff08\uff09\u4e0e\u524d\u6587\u8bb2\u89e3\u7684put_user\uff08\uff09\u7684\u533a\u522b\u5728\u4e8e\u524d\u8005\u4e0d\u8fdb\u884c\u7c7b\u4f3caccess_ok\uff08\uff09\u7684\u68c0\u67e5\uff0c\u800c\u540e\u8005\u4f1a\u8fdb\u884c\u8fd9\u4e00\u68c0\u67e5\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u4e0d\u4f7f\u7528put_user\uff08\uff09\u800c\u4f7f\u7528"),"put_user\uff08\uff09\u7684\u539f\u56e0\u662f\u5728",(0,o.kt)("strong",{parentName:"p"},"put_user\uff08\uff09\u8c03\u7528\u4e4b\u524d\uff0c\u5df2\u7ecf\u624b\u52a8\u68c0\u67e5\u4e86\u7528\u6237\u7a7a\u95f4\u7f13\u51b2\u533a\uff08buf\u6307\u5411\u7684\u5927\u5c0f\u4e3acount\u7684\u5185\u5b58\uff09\u7684\u5408\u6cd5\u6027\u3002get_user\uff08\uff09\u548c"),"get_user\uff08\uff09\u7684\u533a\u522b\u4e5f\u76f8\u4f3c\u3002"),(0,o.kt)("p",null,"\u7279\u522b\u8981\u63d0\u9192\u8bfb\u8005\u6ce8\u610f\u7684\u662f\uff1a\u5728\u5185\u6838\u7a7a\u95f4\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u754c\u9762\u5904\uff0c\u5185\u6838\u68c0\u67e5\u7528\u6237\u7a7a\u95f4\u7f13\u51b2\u533a\u7684\u5408\u6cd5\u6027\u663e\u5f97\u5c24\u5176\u5fc5\u8981\uff0cLinux\u5185\u6838\u7684\u8bb8\u591a\u5b89\u5168\u6f0f\u6d1e\u90fd\u662f\u56e0\u4e3a\u9057\u5fd8\u4e86\u8fd9\u4e00\u68c0\u67e5\u9020\u6210\u7684\uff0c\u975e\u6cd5\u4fb5\u5165\u8005\u53ef\u4ee5\u4f2a\u9020\u4e00\u7247\u5185\u6838\u7a7a\u95f4\u7684\u7f13\u51b2\u533a\u5730\u5740\u4f20\u5165\u7cfb\u7edf\u8c03\u7528\u7684\u63a5\u53e3\uff0c\u8ba9\u5185\u6838\u5bf9\u8fd9\u4e2aevil\u6307\u9488\u6307\u5411\u7684\u5185\u6838\u7a7a\u95f4\u586b\u5145\u6570\u636e\u3002\u6709\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u4ece",(0,o.kt)("a",{parentName:"p",href:"http://www.cvedetails.com/"},"http://www.cvedetails.com/")," \u7f51\u7ad9\u67e5\u9605Linux CVE\uff08Common Vulnerabilities and Exposures\uff09\u5217\u8868\u3002"),(0,o.kt)("p",null,"\u5176\u5b9ecopy_from_user\uff08\uff09\u3001copy_to_user\uff08\uff09\u5185\u90e8\u4e5f\u8fdb\u884c\u4e86\u8fd9\u6837\u7684\u68c0\u67e5\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"static inline unsigned long __must_check copy_from_user(void *to, const void __user\n    *from, unsigned long n)\n{\n        if (access_ok(VERIFY_READ, from, n))\n                n = __copy_from_user(to, from, n);\n        else /* security hole - plug it */\n                memset(to, 0, n);\n        return n;\n}\nstatic inline unsigned long __must_check copy_to_user(void __user *to, const void\n    *from, unsigned long n)\n{\n        if (access_ok(VERIFY_WRITE, to, n))\n                n = __copy_to_user(to, from, n);\n        return n;\n}\n")),(0,o.kt)("p",null,"I/O\u63a7\u5236\u51fd\u6570\u7684cmd\u53c2\u6570\u4e3a\u4e8b\u5148\u5b9a\u4e49\u7684I/O\u63a7\u5236\u547d\u4ee4\uff0c\u800carg\u4e3a\u5bf9\u5e94\u4e8e\u8be5\u547d\u4ee4\u7684\u53c2\u6570\u3002\u4f8b\u5982\u5bf9\u4e8e\u4e32\u884c\u8bbe\u5907\uff0c\u5982\u679cSET_BAUDRATE\u662f\u4e00\u9053\u8bbe\u7f6e\u6ce2\u7279\u7387\u7684\u547d\u4ee4\uff0c\u90a3\u540e\u9762\u7684arg\u5c31\u5e94\u8be5\u662f\u6ce2\u7279\u7387\u503c\u3002"),(0,o.kt)("p",null,"\u5728\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u4e2d\uff0c\u9700\u8981\u5b9a\u4e49\u4e00\u4e2afile_operations\u7684\u5b9e\u4f8b\uff0c\u5e76\u5c06\u5177\u4f53\u8bbe\u5907\u9a71\u52a8\u7684\u51fd\u6570\u8d4b\u503c\u7ed9file_operations\u7684\u6210\u5458\uff0c\u5982\u4ee3\u7801\u6e05\u53556.7\u6240\u793a\u3002"),(0,o.kt)("p",null,"\u4ee3\u7801\u6e05\u53556.7\u3000\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u6587\u4ef6\u64cd\u4f5c\u7ed3\u6784\u4f53\u6a21\u677f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"1struct file_operations xxx_fops = {\n2     .owner = THIS_MODULE,\n3     .read = xxx_read,\n4     .write = xxx_write,\n5     .unlocked_ioctl= xxx_ioctl,\n6     ...\n7};\n")),(0,o.kt)("p",null,"\u4e0a\u8ff0xxx_fops\u5728\u4ee3\u7801\u6e05\u53556.5\u7b2c10\u884c\u7684cdev_init\uff08&xxx_dev.cdev\uff0c&xxx_fops\uff09\u7684\u8bed\u53e5\u4e2d\u5efa\u7acb\u4e0ecdev\u7684\u8fde\u63a5\u3002"),(0,o.kt)("p",null,"\u56fe6.1\u6240\u793a\u4e3a\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684\u7ed3\u6784\u3001\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u4e0e\u5b57\u7b26\u8bbe\u5907\u4ee5\u53ca\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u4e0e\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u8be5\u8bbe\u5907\u7684\u7a0b\u5e8f\u4e4b\u95f4\u7684\u5173\u7cfb\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"1742913494444",src:n(5806).Z,width:"1369",height:"522"})),(0,o.kt)("p",null,"\u56fe6.1\u3000\u5b57\u7b26\u8bbe\u5907\u9a71\u52a8\u7684\u7ed3\u6784"))}a.isMDXComponent=!0},5806:function(e,t,n){t.Z=n.p+"assets/images/1742913494444-cf3980e830bba576f86df2ff2cbbae2c.png"}}]);