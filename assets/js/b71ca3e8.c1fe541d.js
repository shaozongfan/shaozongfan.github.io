"use strict";(self.webpackChunkshaozongfan_website=self.webpackChunkshaozongfan_website||[]).push([[19735],{3905:function(n,t,e){e.d(t,{Zo:function(){return o},kt:function(){return d}});var r=e(67294);function l(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function i(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?i(Object(e),!0).forEach((function(t){l(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function u(n,t){if(null==n)return{};var e,r,l=function(n,t){if(null==n)return{};var e,r,l={},i=Object.keys(n);for(r=0;r<i.length;r++)e=i[r],t.indexOf(e)>=0||(l[e]=n[e]);return l}(n,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)e=i[r],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(l[e]=n[e])}return l}var c=r.createContext({}),s=function(n){var t=r.useContext(c),e=t;return n&&(e="function"==typeof n?n(t):a(a({},t),n)),e},o=function(n){var t=s(n.components);return r.createElement(c.Provider,{value:t},n.children)},p={inlineCode:"code",wrapper:function(n){var t=n.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(n,t){var e=n.components,l=n.mdxType,i=n.originalType,c=n.parentName,o=u(n,["components","mdxType","originalType","parentName"]),f=s(e),d=l,g=f["".concat(c,".").concat(d)]||f[d]||p[d]||i;return e?r.createElement(g,a(a({ref:t},o),{},{components:e})):r.createElement(g,a({ref:t},o))}));function d(n,t){var e=arguments,l=t&&t.mdxType;if("string"==typeof n||l){var i=e.length,a=new Array(i);a[0]=f;var u={};for(var c in t)hasOwnProperty.call(t,c)&&(u[c]=t[c]);u.originalType=n,u.mdxType="string"==typeof n?n:l,a[1]=u;for(var s=2;s<i;s++)a[s]=e[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,e)}f.displayName="MDXCreateElement"},49527:function(n,t,e){e.r(t),e.d(t,{assets:function(){return o},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return u},metadata:function(){return s},toc:function(){return p}});var r=e(87462),l=e(63366),i=(e(67294),e(3905)),a=["components"],u={},c="9.2.1\u3000Linux\u4fe1\u53f7",s={unversionedId:"\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.2\u3000Linux\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b",id:"\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.2\u3000Linux\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b",title:"9.2.1\u3000Linux\u4fe1\u53f7",description:"\u4f7f\u7528\u4fe1\u53f7\u8fdb\u884c\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u662fUNIX\u4e2d\u7684\u4e00\u79cd\u4f20\u7edf\u673a\u5236\uff0cLinux\u4e5f\u652f\u6301\u8fd9\u79cd\u673a\u5236\u3002\u5728Linux\u4e2d\uff0c\u5f02\u6b65\u901a\u77e5\u4f7f\u7528\u4fe1\u53f7\u6765\u5b9e\u73b0\uff0cLinux\u4e2d\u53ef\u7528\u7684\u4fe1\u53f7\u53ca\u5176\u5b9a\u4e49\u5982\u88689.1\u6240\u793a\u3002",source:"@site/docs/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.2\u3000Linux\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b.md",sourceDirName:"\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3",slug:"/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.2\u3000Linux\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b",permalink:"/docs/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.2\u3000Linux\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b",draft:!1,editUrl:"https://github.com/shaozongfan/shaozongfan.github.io/docs/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.2\u3000Linux\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"9.1\u3000\u5f02\u6b65\u901a\u77e5\u7684\u6982\u5ff5\u4e0e\u4f5c\u7528",permalink:"/docs/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.1\u3000\u5f02\u6b65\u901a\u77e5\u7684\u6982\u5ff5\u4e0e\u4f5c\u7528"},next:{title:"9.3.1\u3000\u5728globalfifo\u9a71\u52a8\u4e2d\u589e\u52a0\u5f02\u6b65\u901a\u77e5",permalink:"/docs/\u6280\u672f\u535a\u5ba2/\u5d4c\u5165\u5f0f/linux\u8bbe\u5907\u9a71\u52a8\u5f00\u53d1\u8be6\u89e3/9.3\u3000\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684globalfifo\u9a71\u52a8"}},o={},p=[],f={toc:p};function d(n){var t=n.components,u=(0,l.Z)(n,a);return(0,i.kt)("wrapper",(0,r.Z)({},f,u,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"921linux\u4fe1\u53f7"},"9.2.1\u3000Linux\u4fe1\u53f7"),(0,i.kt)("p",null,"\u4f7f\u7528\u4fe1\u53f7\u8fdb\u884c\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u662fUNIX\u4e2d\u7684\u4e00\u79cd\u4f20\u7edf\u673a\u5236\uff0cLinux\u4e5f\u652f\u6301\u8fd9\u79cd\u673a\u5236\u3002\u5728Linux\u4e2d\uff0c\u5f02\u6b65\u901a\u77e5\u4f7f\u7528\u4fe1\u53f7\u6765\u5b9e\u73b0\uff0cLinux\u4e2d\u53ef\u7528\u7684\u4fe1\u53f7\u53ca\u5176\u5b9a\u4e49\u5982\u88689.1\u6240\u793a\u3002"),(0,i.kt)("p",null,"\u88689.1\u3000Linux\u4fe1\u53f7\u53ca\u5176\u5b9a\u4e49"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"image-20250329151020572",src:e(38275).Z,width:"1390",height:"801"})),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"image-20250329151038482",src:e(57955).Z,width:"1464",height:"784"})),(0,i.kt)("p",null,"\u9664\u4e86SIGSTOP\u548cSIGKILL\u4e24\u4e2a\u4fe1\u53f7\u5916\uff0c\u8fdb\u7a0b\u80fd\u591f\u5ffd\u7565\u6216\u6355\u83b7\u5176\u4ed6\u7684\u5168\u90e8\u4fe1\u53f7\u3002\u4e00\u4e2a\u4fe1\u53f7\u88ab\u6355\u83b7\u7684\u610f\u601d\u662f\u5f53\u4e00\u4e2a\u4fe1\u53f7\u5230\u8fbe\u65f6\u6709\u76f8\u5e94\u7684\u4ee3\u7801\u5904\u7406\u5b83\u3002\u5982\u679c\u4e00\u4e2a\u4fe1\u53f7\u6ca1\u6709\u88ab\u8fd9\u4e2a\u8fdb\u7a0b\u6240\u6355\u83b7\uff0c\u5185\u6838\u5c06\u91c7\u7528\u9ed8\u8ba4\u884c\u4e3a\u5904\u7406\u3002"),(0,i.kt)("h1",{id:"922\u4fe1\u53f7\u7684\u63a5\u6536"},"9.2.2\u3000\u4fe1\u53f7\u7684\u63a5\u6536"),(0,i.kt)("p",null,"\u5728\u7528\u6237\u7a0b\u5e8f\u4e2d\uff0c\u4e3a\u4e86\u6355\u83b7\u4fe1\u53f7\uff0c\u53ef\u4ee5\u4f7f\u7528signal\uff08\uff09\u51fd\u6570\u6765\u8bbe\u7f6e\u5bf9\u5e94\u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"void (*signal(int signum, void (*handler))(int)))(int);\n")),(0,i.kt)("p",null,"\u8be5\u51fd\u6570\u539f\u578b\u8f83\u96be\u7406\u89e3\uff0c\u5b83\u53ef\u4ee5\u5206\u89e3\u4e3a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"typedef void (*sighandler_t)(int);\nsighandler_t signal(int signum, sighandler_t handler));\n")),(0,i.kt)("p",null,"\u7b2c\u4e00\u4e2a\u53c2\u6570\u6307\u5b9a\u4fe1\u53f7\u7684\u503c\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6307\u5b9a\u9488\u5bf9\u524d\u9762\u4fe1\u53f7\u503c\u7684\u5904\u7406\u51fd\u6570\uff0c\u82e5\u4e3aSIG_IGN\uff0c\u8868\u793a\u5ffd\u7565\u8be5\u4fe1\u53f7\uff1b\u82e5\u4e3aSIG_DFL\uff0c\u8868\u793a\u91c7\u7528\u7cfb\u7edf\u9ed8\u8ba4\u65b9\u5f0f\u5904\u7406\u4fe1\u53f7\uff1b\u82e5\u4e3a\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u5219\u4fe1\u53f7\u88ab\u6355\u83b7\u5230\u540e\uff0c\u8be5\u51fd\u6570\u5c06\u88ab\u6267\u884c\u3002"),(0,i.kt)("p",null,"\u5982\u679csignal\uff08\uff09\u8c03\u7528\u6210\u529f\uff0c\u5b83\u8fd4\u56de\u6700\u540e\u4e00\u6b21\u4e3a\u4fe1\u53f7signum\u7ed1\u5b9a\u7684\u5904\u7406\u51fd\u6570\u7684handler\u503c\uff0c\u5931\u8d25\u5219\u8fd4\u56deSIG_ERR\u3002"),(0,i.kt)("p",null,"\u5728\u8fdb\u7a0b\u6267\u884c\u65f6\uff0c\u6309\u4e0b\u201cCtrl+C\u201d\u5c06\u5411\u5176\u53d1\u51faSIGINT\u4fe1\u53f7\uff0c\u6b63\u5728\u8fd0\u884ckill\u7684\u8fdb\u7a0b\u5c06\u5411\u5176\u53d1\u51faSIGTERM\u4fe1\u53f7\uff0c\u4ee3\u7801\u6e05\u53559.1\u7684\u8fdb\u7a0b\u53ef\u6355\u83b7\u8fd9\u4e24\u4e2a\u4fe1\u53f7\u5e76\u8f93\u51fa\u4fe1\u53f7\u503c\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u6e05\u53559.1\u3000signal\uff08\uff09\u6355\u83b7\u4fe1\u53f7\u8303\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},' 1void sigterm_handler(int signo)\n 2{\n 3  printf("Have caught sig N.O. %d\\n", signo);\n 4  exit(0);\n 5}\n 6\n 7int main(void)\n 8{\n 9  signal(SIGINT, sigterm_handler);\n10  signal(SIGTERM, sigterm_handler);\n11  while(1);\n12\n13  return 0;\n14}\n')),(0,i.kt)("p",null,"\u9664\u4e86signal\uff08\uff09\u51fd\u6570\u5916\uff0csigaction\uff08\uff09\u51fd\u6570\u53ef\u7528\u4e8e\u6539\u53d8\u8fdb\u7a0b\u63a5\u6536\u5230\u7279\u5b9a\u4fe1\u53f7\u540e\u7684\u884c\u4e3a\uff0c\u5b83\u7684\u539f\u578b\u4e3a\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"int sigaction(int signum,const struct sigaction *act,struct sigaction *oldact));\n")),(0,i.kt)("p",null,"\u8be5\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u4fe1\u53f7\u7684\u503c\uff0c\u53ef\u4ee5\u662f\u9664SIGKILL\u53caSIGSTOP\u5916\u7684\u4efb\u4f55\u4e00\u4e2a\u7279\u5b9a\u6709\u6548\u7684\u4fe1\u53f7\u3002\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u6307\u5411\u7ed3\u6784\u4f53sigaction\u7684\u4e00\u4e2a\u5b9e\u4f8b\u7684\u6307\u9488\uff0c\u5728\u7ed3\u6784\u4f53sigaction\u7684\u5b9e\u4f8b\u4e2d\uff0c\u6307\u5b9a\u4e86\u5bf9\u7279\u5b9a\u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\uff0c\u82e5\u4e3a\u7a7a\uff0c\u5219\u8fdb\u7a0b\u4f1a\u4ee5\u7f3a\u7701\u65b9\u5f0f\u5bf9\u4fe1\u53f7\u5904\u7406\uff1b\u7b2c\u4e09\u4e2a\u53c2\u6570oldact\u6307\u5411\u7684\u5bf9\u8c61\u7528\u6765\u4fdd\u5b58\u539f\u6765\u5bf9\u76f8\u5e94\u4fe1\u53f7\u7684\u5904\u7406\u51fd\u6570\uff0c\u53ef\u6307\u5b9aoldact\u4e3aNULL\u3002\u5982\u679c\u628a\u7b2c\u4e8c\u3001\u7b2c\u4e09\u4e2a\u53c2\u6570\u90fd\u8bbe\u4e3aNULL\uff0c\u90a3\u4e48\u8be5\u51fd\u6570\u53ef\u7528\u4e8e\u68c0\u67e5\u4fe1\u53f7\u7684\u6709\u6548\u6027\u3002"),(0,i.kt)("p",null,"\u5148\u6765\u770b\u4e00\u4e2a\u4f7f\u7528\u4fe1\u53f7\u5b9e\u73b0\u5f02\u6b65\u901a\u77e5\u7684\u4f8b\u5b50\uff0c\u5b83\u901a\u8fc7signal\uff08SIGIO\uff0cinput_handler\uff09\u5bf9\u6807\u51c6\u8f93\u5165\u6587\u4ef6\u63cf\u8ff0\u7b26STDIN_FILENO\u542f\u52a8\u4fe1\u53f7\u673a\u5236\u3002\u7528\u6237\u8f93\u5165\u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c06\u63a5\u6536\u5230SIGIO\u4fe1\u53f7\uff0c\u5176\u5904\u7406\u51fd\u6570input_handler\uff08\uff09\u5c06\u88ab\u8c03\u7528\uff0c\u5982\u4ee3\u7801\u6e05\u53559.2\u6240\u793a\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u6e05\u53559.2\u3000\u4f7f\u7528\u4fe1\u53f7\u5b9e\u73b0\u5f02\u6b65\u901a\u77e5\u7684\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},' 1#include <sys/types.h>\n 2#include <sys/stat.h>\n 3#include <stdio.h>\n 4#include <fcntl.h>\n 5#include <signal.h>\n 6#include <unistd.h>\n 7#define MAX_LEN 100\n 8void input_handler(int num)\n 9{\n10  char data[MAX_LEN];\n11  int len;\n12\n13  /* \u8bfb\u53d6\u5e76\u8f93\u51faSTDIN_FILENO\u4e0a\u7684\u8f93\u5165 */\n14  len = read(STDIN_FILENO, &data, MAX_LEN);\n15  data[len] = 0;\n16  printf("input available:%s\\n", data);\n17}\n18\n19main()\n20{\n21  int oflags;\n22\n23  /* \u542f\u52a8\u4fe1\u53f7\u9a71\u52a8\u673a\u5236*/\n24  signal(SIGIO, input_handler);\n25  fcntl(STDIN_FILENO, F_SETOWN, getpid());\n26  oflags = fcntl(STDIN_FILENO, F_GETFL);\n27  fcntl(STDIN_FILENO, F_SETFL, oflags | FASYNC);\n28\n29 /* \u6700\u540e\u8fdb\u5165\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u4ec5\u4e3a\u4fdd\u6301\u8fdb\u7a0b\u4e0d\u7ec8\u6b62\uff0c\u5982\u679c\u7a0b\u5e8f\u4e2d\n30 \u6ca1\u6709\u8fd9\u4e2a\u6b7b\u5faa\u4f1a\u7acb\u5373\u6267\u884c\u5b8c\u6bd5*/\n31 while (1);\n32}\n')),(0,i.kt)("p",null,"\u4e0a\u8ff0\u4ee3\u780124\u884c\u4e3aSIGIO\u4fe1\u53f7\u5b89\u88c5input_handler\uff08\uff09\u4f5c\u4e3a\u5904\u7406\u51fd\u6570\uff0c\u7b2c25\u884c\u8bbe\u7f6e\u672c\u8fdb\u7a0b\u4e3aSTDIN_FILENO\u6587\u4ef6\u7684\u62e5\u6709\u8005\uff0c\u6ca1\u6709\u8fd9\u4e00\u6b65\uff0c\u5185\u6838\u4e0d\u4f1a\u77e5\u9053\u5e94\u8be5\u5c06\u4fe1\u53f7\u53d1\u7ed9\u54ea\u4e2a\u8fdb\u7a0b\u3002\u800c\u4e3a\u4e86\u542f\u7528\u5f02\u6b65\u901a\u77e5\u673a\u5236\uff0c\u8fd8\u9700\u5bf9\u8bbe\u5907\u8bbe\u7f6eFASYNC\u6807\u5fd7\uff0c\u7b2c26\u884c\u300127\u884c\u4ee3\u7801\u53ef\u5b9e\u73b0\u6b64\u76ee\u7684\u3002\u6574\u4e2a\u7a0b\u5e8f\u7684\u6267\u884c\u6548\u679c\u5982\u4e0b\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"[root@localhost driver_study]# ./signal_test\nI am Chinese.                            -> \u7528\u6237\u8f93\u5165\ninput available: I am Chinese.            -> signal_test\u7a0b\u5e8f\u6253\u5370\nI love Linux driver.                      -> \u7528\u6237\u8f93\u5165\ninput available: I love Linux driver.    -> signal_test\u7a0b\u5e8f\u6253\u5370\n\n")),(0,i.kt)("p",null,"\u4ece\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53\u7528\u6237\u8f93\u5165\u4e00\u4e32\u5b57\u7b26\u540e\uff0c\u6807\u51c6\u8f93\u5165\u8bbe\u5907\u91ca\u653eSIGIO\u4fe1\u53f7\uff0c\u8fd9\u4e2a\u4fe1\u53f7\u201c\u4e2d\u65ad\u201d\u4e0e\u9a71\u4f7f\u5bf9\u5e94\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684input_handler\uff08\uff09\u5f97\u4ee5\u6267\u884c\uff0c\u5e76\u5c06\u7528\u6237\u8f93\u5165\u663e\u793a\u51fa\u6765\u3002"),(0,i.kt)("p",null,"\u7531\u6b64\u53ef\u89c1\uff0c\u4e3a\u4e86\u80fd\u5728\u7528\u6237\u7a7a\u95f4\u4e2d\u5904\u7406\u4e00\u4e2a\u8bbe\u5907\u91ca\u653e\u7684\u4fe1\u53f7\uff0c\u5b83\u5fc5\u987b\u5b8c\u62103\u9879\u5de5\u4f5c\u3002"),(0,i.kt)("p",null,"1\uff09\u901a\u8fc7F_SETOWN IO\u63a7\u5236\u547d\u4ee4\u8bbe\u7f6e\u8bbe\u5907\u6587\u4ef6\u7684\u62e5\u6709\u8005\u4e3a\u672c\u8fdb\u7a0b\uff0c\u8fd9\u6837\u4ece\u8bbe\u5907\u9a71\u52a8\u53d1\u51fa\u7684\u4fe1\u53f7\u624d\u80fd\u88ab\u672c\u8fdb\u7a0b\u63a5\u6536\u5230\u3002"),(0,i.kt)("p",null,"2\uff09\u901a\u8fc7F_SETFL IO\u63a7\u5236\u547d\u4ee4\u8bbe\u7f6e\u8bbe\u5907\u6587\u4ef6\u4ee5\u652f\u6301FASYNC\uff0c\u5373\u5f02\u6b65\u901a\u77e5\u6a21\u5f0f\u3002"),(0,i.kt)("p",null,"3\uff09\u901a\u8fc7signal\uff08\uff09\u51fd\u6570\u8fde\u63a5\u4fe1\u53f7\u548c\u4fe1\u53f7\u5904\u7406\u51fd\u6570"),(0,i.kt)("h1",{id:"923\u4fe1\u53f7\u7684\u91ca\u653e"},"9.2.3\u3000\u4fe1\u53f7\u7684\u91ca\u653e"),(0,i.kt)("p",null,"\u5728\u8bbe\u5907\u9a71\u52a8\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u5f02\u6b65\u901a\u77e5\u4ea4\u4e92\u4e2d\uff0c\u4ec5\u4ec5\u5728\u5e94\u7528\u7a0b\u5e8f\u7aef\u6355\u83b7\u4fe1\u53f7\u662f\u4e0d\u591f\u7684\uff0c\u56e0\u4e3a\u4fe1\u53f7\u7684\u6e90\u5934\u5728\u8bbe\u5907\u9a71\u52a8\u7aef\u3002\u56e0\u6b64\uff0c\u5e94\u8be5\u5728\u5408\u9002\u7684\u65f6\u673a\u8ba9\u8bbe\u5907\u9a71\u52a8\u91ca\u653e\u4fe1\u53f7\uff0c\u5728\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u4e2d\u589e\u52a0\u4fe1\u53f7\u91ca\u653e\u7684\u76f8\u5173\u4ee3\u7801\u3002"),(0,i.kt)("p",null,"\u4e3a\u4e86\u4f7f\u8bbe\u5907\u652f\u6301\u5f02\u6b65\u901a\u77e5\u673a\u5236\uff0c\u9a71\u52a8\u7a0b\u5e8f\u4e2d\u6d89\u53ca3\u9879\u5de5\u4f5c\u3002"),(0,i.kt)("p",null,"1\uff09\u652f\u6301F_SETOWN\u547d\u4ee4\uff0c\u80fd\u5728\u8fd9\u4e2a\u63a7\u5236\u547d\u4ee4\u5904\u7406\u4e2d\u8bbe\u7f6efilp->f_owner\u4e3a\u5bf9\u5e94\u8fdb\u7a0bID\u3002\u4e0d\u8fc7\u6b64\u9879\u5de5\u4f5c\u5df2\u7531\u5185\u6838\u5b8c\u6210\uff0c\u8bbe\u5907\u9a71\u52a8\u65e0\u987b\u5904\u7406\u3002"),(0,i.kt)("p",null,"2\uff09\u652f\u6301F_SETFL\u547d\u4ee4\u7684\u5904\u7406\uff0c\u6bcf\u5f53FASYNC\u6807\u5fd7\u6539\u53d8\u65f6\uff0c\u9a71\u52a8\u7a0b\u5e8f\u4e2d\u7684fasync\uff08\uff09\u51fd\u6570\u5c06\u5f97\u4ee5\u6267\u884c\u3002\u56e0\u6b64\uff0c\u9a71\u52a8\u4e2d\u5e94\u8be5\u5b9e\u73b0fasync\uff08\uff09\u51fd\u6570\u3002"),(0,i.kt)("p",null,"3\uff09\u5728\u8bbe\u5907\u8d44\u6e90\u53ef\u83b7\u5f97\u65f6\uff0c\u8c03\u7528kill_fasync\uff08\uff09\u51fd\u6570\u6fc0\u53d1\u76f8\u5e94\u7684\u4fe1\u53f7\u3002"),(0,i.kt)("p",null,"\u9a71\u52a8\u4e2d\u7684\u4e0a\u8ff03\u9879\u5de5\u4f5c\u548c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u76843\u9879\u5de5\u4f5c\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff0c\u56fe9.2\u6240\u793a\u4e3a\u5f02\u6b65\u901a\u77e5\u5904\u7406\u8fc7\u7a0b\u4e2d\u7528\u6237\u7a7a\u95f4\u548c\u8bbe\u5907\u9a71\u52a8\u7684\u4ea4\u4e92\u3002"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"image-20250329161212970",src:e(65146).Z,width:"1212",height:"496"})),(0,i.kt)("p",null,"\u56fe9.2\u3000\u5f02\u6b65\u901a\u77e5\u4e2d\u8bbe\u5907\u9a71\u52a8\u548c\u5f02\u6b65\u901a\u77e5\u7684\u4ea4\u4e92"),(0,i.kt)("p",null,"\u8bbe\u5907\u9a71\u52a8\u4e2d\u5f02\u6b65\u901a\u77e5\u7f16\u7a0b\u6bd4\u8f83\u7b80\u5355\uff0c\u4e3b\u8981\u7528\u5230\u4e00\u9879\u6570\u636e\u7ed3\u6784\u548c\u4e24\u4e2a\u51fd\u6570\u3002\u6570\u636e\u7ed3\u6784\u662ffasync_struct\u7ed3\u6784\u4f53\uff0c\u4e24\u4e2a\u51fd\u6570\u5206\u522b\u662f\uff1a"),(0,i.kt)("p",null,"1\uff09\u5904\u7406FASYNC\u6807\u5fd7\u53d8\u66f4\u7684\u51fd\u6570\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"int fasync_helper(int fd, struct file *filp, int mode, struct fasync_struct **fa);\n")),(0,i.kt)("p",null,"2\uff09\u91ca\u653e\u4fe1\u53f7\u7528\u7684\u51fd\u6570\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"void kill_fasync(struct fasync_struct **fa, int sig, int band);\n")),(0,i.kt)("p",null,"\u548c\u5176\u4ed6\u7684\u8bbe\u5907\u9a71\u52a8\u4e00\u6837\uff0c\u5c06fasync_struct\u7ed3\u6784\u4f53\u6307\u9488\u653e\u5728\u8bbe\u5907\u7ed3\u6784\u4f53\u4e2d\u4ecd\u7136\u662f\u6700\u4f73\u9009\u62e9\uff0c\u4ee3\u7801\u6e05\u53559.3\u7ed9\u51fa\u4e86\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u7ed3\u6784\u4f53\u6a21\u677f\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u6e05\u53559.3\u3000\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u7ed3\u6784\u4f53\u6a21\u677f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," 1struct xxx_dev {\n 2   struct cdev cdev;                    /* cdev\u7ed3\u6784\u4f53*/\n 3   ...\n 4   struct fasync_struct *async_queue;   /* \u5f02\u6b65\u7ed3\u6784\u4f53\u6307\u9488 */\n 5};\n")),(0,i.kt)("p",null,"\u5728\u8bbe\u5907\u9a71\u52a8\u7684fasync\uff08\uff09\u51fd\u6570\u4e2d\uff0c\u53ea\u9700\u8981\u7b80\u5355\u5730\u5c06\u8be5\u51fd\u6570\u76843\u4e2a\u53c2\u6570\u4ee5\u53cafasync_struct\u7ed3\u6784\u4f53\u6307\u9488\u7684\u6307\u9488\u4f5c\u4e3a\u7b2c4\u4e2a\u53c2\u6570\u4f20\u5165fasync_helper\uff08\uff09\u51fd\u6570\u5373\u53ef\u3002\u4ee3\u7801\u6e05\u53559.4\u7ed9\u51fa\u4e86\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8ffasync\uff08\uff09\u51fd\u6570\u7684\u6a21\u677f\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u6e05\u53559.4\u3000\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u9a71\u52a8fasync\uff08\uff09\u51fd\u6570\u6a21\u677f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," 1static int xxx_fasync(int fd, struct file *filp, int mode)\n 2{\n 3  struct xxx_dev *dev = filp->private_data;\n 4  return fasync_helper(fd, filp, mode, &dev->async_queue);\n 5}\n")),(0,i.kt)("p",null,"\u5728\u8bbe\u5907\u8d44\u6e90\u53ef\u4ee5\u83b7\u5f97\u65f6\uff0c\u5e94\u8be5\u8c03\u7528kill_fasync\uff08\uff09\u91ca\u653eSIGIO\u4fe1\u53f7\u3002\u5728\u53ef\u8bfb\u65f6\uff0c\u7b2c3\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3aPOLL_IN\uff0c\u5728\u53ef\u5199\u65f6\uff0c\u7b2c3\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3aPOLL_OUT\u3002\u4ee3\u7801\u6e05\u53559.5\u7ed9\u51fa\u4e86\u91ca\u653e\u4fe1\u53f7\u7684\u8303\u4f8b\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u6e05\u53559.5\u3000\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u9a71\u52a8\u4fe1\u53f7\u91ca\u653e\u8303\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," 1static ssize_t xxx_write(struct file *filp, const char __user *buf, size_t count,\n 2                      loff_t *f_pos)\n 3{\n 4     struct xxx_dev *dev = filp->private_data;\n 5     ...\n 6     /* \u4ea7\u751f\u5f02\u6b65\u8bfb\u4fe1\u53f7 */\n 7     if (dev->async_queue)\n 8          kill_fasync(&dev->async_queue, SIGIO, POLL_IN);\n 9...\n10}\n")),(0,i.kt)("p",null,"\u6700\u540e\uff0c\u5728\u6587\u4ef6\u5173\u95ed\u65f6\uff0c\u5373\u5728\u8bbe\u5907\u9a71\u52a8\u7684release\uff08\uff09\u51fd\u6570\u4e2d\uff0c\u5e94\u8c03\u7528\u8bbe\u5907\u9a71\u52a8\u7684fasync\uff08\uff09\u51fd\u6570\u5c06\u6587\u4ef6\u4ece\u5f02\u6b65\u901a\u77e5\u7684\u5217\u8868\u4e2d\u5220\u9664\u3002\u4ee3\u7801\u6e05\u53559.5\u7ed9\u51fa\u4e86\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u9a71\u52a8release\uff08\uff09\u51fd\u6570\u7684\u6a21\u677f\u3002"),(0,i.kt)("p",null,"\u4ee3\u7801\u6e05\u53559.6\u3000\u652f\u6301\u5f02\u6b65\u901a\u77e5\u7684\u8bbe\u5907\u9a71\u52a8release\uff08\uff09\u51fd\u6570\u6a21\u677f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," 1static int xxx_release(struct inode *inode, struct file *filp)\n 2{\n 3   /* \u5c06\u6587\u4ef6\u4ece\u5f02\u6b65\u901a\u77e5\u5217\u8868\u4e2d\u5220\u9664*/\n 4   xxx_fasync(-1, filp, 0);\n 5   ...\n 6   return 0;\n 7}\n")))}d.isMDXComponent=!0},38275:function(n,t,e){t.Z=e.p+"assets/images/image-20250329151020572-902a2017c67b7cfe20fcf9c22db01b6f.png"},57955:function(n,t,e){t.Z=e.p+"assets/images/image-20250329151038482-294719bffb5000d03c64fa5ca3b89558.png"},65146:function(n,t,e){t.Z=e.p+"assets/images/image-20250329161212970-23846bd786e2470dec638d3cd14cc671.png"}}]);